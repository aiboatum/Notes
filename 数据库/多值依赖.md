# 多值依赖

多值依赖是和 4NF 相关的一个概念，即 4NF 消除了属性之间的『非平凡』且『非函数依赖』的多值依赖。

首先明确的是，**函数依赖是多值依赖的一个特殊情况**。

定义1：设 $R(U)$ 是属性集 $U$ 上的一个关系模式。$X,Y,Z\subseteq U$，并且 $Z = U - X - Y$。关系模式 $R(U)$ 中多值依赖 $X→→Y$ 成立，当且仅当对 $R(U)$ 的任一关系 $r$，给定的一对 $(x,z)$ 值，有 **一组**（<mark>也可以是一个，此时对应的就是函数依赖</mark>） $Y$ 的值，这组值仅仅决定于 $x$ 值而与 $z$ 值无关。

现在我们给出一个例子，假设有以下关系模式（非规范化），

| 课程 C |  教师 T   |            参考书 B            |
| :----: | :-------: | :----------------------------: |
|  物理  | 李勇 王军 | 普通物理学 光学原理 物理习题集 |
|  数学  | 李勇 张平 |   数学分析 微分方程 高等代数   |

当然从语义中可以看出，$C→→T$ 成立，而且 $C→→B$ 也成立。即一个 $C$ 可以决定多个 $T$，一个 $C$ 可以决定多个 $B$。

我们从定义1 来思考为什么是这样的？下面给出其规范化的关系模式：

| 课程 C | 教师 T |  参考书 B  |
| :----: | :----: | :--------: |
|  物理  |  李勇  | 普通物理学 |
|  物理  |  李勇  |  光学原理  |
|  物理  |  李勇  | 物理习题集 |
|  物理  |  王军  | 普通物理学 |
|  物理  |  王军  |  光学原理  |
|  物理  |  王军  | 物理习题集 |
|  数学  |  李勇  |  数学分析  |
|  数学  |  李勇  |  微分方程  |
|  数学  |  李勇  |  高等代数  |
|  数学  |  张平  |  数学分析  |
|  数学  |  张平  |  微分方程  |
|  数学  |  张平  |  高等代数  |

这里可以看到，对于一个（物理，光学原理）有一组 T 值 {李勇，王军}，这组值仅仅决定于课程 C 上的值，即物理。**也就是说**，对于另一个（物理，普通物理学），它对应的一组 T 仍然是 {李勇，王军}，尽管此时的 B 的值改变，但是 T 仍然不变。因此 $C→→T$，同理 $C→→B$。

### 非平凡的多值依赖

若 $X→→Y$，而 $Z=Φ$，则称 $X→→Y$ 为 **平凡的多值依赖**，否则称为 **非平凡的多值依赖**。

<font color = "blue"> 非平凡的多值依赖中，去掉 Y 元素后（此时成为了平凡的多值依赖），对于整个依赖关系没有影响</font>。这也是为什么去除非函数依赖且非平凡的多值依赖的缘由。

**定义2**：设 $\forall r \in R(U)$，$X,Y,Z\subseteq U$，如果存在元组 $t$、$s$ 使得 $t[X]=s[X]$，那么必然存在元组 $w,v\in r$（$w$，$v$ 可以和 $t$、$s$ 相同），使得 $w[X]=v[X]=t[X]$，而 $w[Y]=t[Y]$，$w[Z]=S[Z]$，$v[Y]=S[Y]$，$v[Z]=t[Z]$（**即交换 s、t 元组的 Y 值所得的两个新元组必然在 r 中**），则 $X→→Y$。其中，$Z=U-X-Y$。


### 多值依赖的一些性质

* **定义1和定义2是等价的**，证明见论文《关于多值依赖的几点注记》。
* 多值依赖具有对称性：若 X→→Y，则 X→→Z，其中 Z = U-X-Y
* 多值依赖具有传递性：若 X→→Y，Y→→Z，则 **X→→Z–Y**
* <font color = "blue"> 函数依赖是多值依赖的特殊情况</font>：若 X→Y，则 X→→Y。可以理解为这里的多值中的多即为1。
* 若 X→→Y，X→→Z，则 X→→YZ，这里的 YZ= Y∪Z。
* 若 X→→Y，X→→Z，则 X→→Y∩Z。
* 若 X→→Y，X→→Z，则 X→→Y-Z，X→→Z-Y。

## 一些例子

对于以下关系，我们可以看到 $X→→(Y,Z)$，但是其不满足 $X→→Y$ 或 $X→→Z$，而且这是一个平凡的多值依赖。

|   X   |   Y   |   Z   |
| :---: | :---: | :---: |
| $x_1$ | $y_1$ | $z_1$ |
| $x_1$ | $y_2$ | $z_2$ |
| $x_1$ | $y_3$ | $z_3$ |

我们取 $t=(x_1,y_1,z_1)$，$s=(x_1,y_2,z_2)$，当我们交换元组 t 和 s 中的属性 Z 中的值，所得到的两个新元组 $t'=(x_1,y_1,z_2)$，$s'=(x_1,y_2,z_1)$，不在关系中。因此该关系并不满足 $X\rightarrow Y$ 或 $X\rightarrow Z$.

同样的，我们可以看到交换元组 t 和 s 中的 Y,Z 属性字段，是满足 $X\rightarrow \rightarrow (Y,Z)$ 的。

故而，我们可以得到下面的关系是满足 $X\rightarrow Y$ 和 $X\rightarrow Z$.

|   X   |   Y   |   Z   |
| :---: | :---: | :---: |
| $x_1$ | $y_1$ | $z_1$ |
| $x_1$ | $y_1$ | $z_2$ |
| $x_1$ | $y_2$ | $z_1$ |
| $x_1$ | $y_2$ | $z_2$ |
| $x_1$ | $y_3$ | $z_1$ |
| $x_1$ | $y_3$ | $z_2$ |
| $x_1$ | $y_3$ | $z_3$ |

## 多值依赖和函数依赖的不同

应当注意，<font color="blue">多值依赖的有效性和属性集的范围有关</font>。这也是我们上面一直有强调 $U=Z-X-Y$ 的原因。

若 $X\rightarrow Y$ 在 U 上成立，则 $W(XY\subseteq W\subseteq U)$ 上一定成立；反之则不一定，即 $X\rightarrow Y$ 在 $W(W\subset U)$ 上成立，则在 U 上不一定成立。<font color="blue">这是因为多值依赖的定义中，不仅涉及到属性组 X 和 Y，而且涉及到 U 中其余属性 Z。 </font>

> 在 R(U) 上若有 $X\rightarrow Y$ 在 $W(W\subset U)$ 上成立，则称为『嵌入式多值依赖』。