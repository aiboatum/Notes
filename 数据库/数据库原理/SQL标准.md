# SQL 标准

SQL 标准是关系数据库的标准语言。SQL 最重要的当然是查询功能，但也包括其他重要功能。这里的 SQL 指的是标准 SQL，而不是指的某个数据库实现的 SQL，如 SQL on MySql。

## SQL 的特点

相比于非关系数据库，SQL 主要有以下特点或优点：
### DDL，DML，DCL 的功能于一体，语言风格统一

* 定义和修改、删除关系模式，定义和删除视图，插入数据，建立数据库
* 数据查询和更新
* 数据库的重构和维护
* 数据库安全性、完整性控制，以及事务控制
* 嵌入式 SQL 和动态 SQL

### 高度非过程化

非关系数据库的数据操纵语言是『面向过程』的，用过程化的语言完成某项请求，并且必须指明存取路径。

使用 SQL 进行数据操作时，只需要提出做什么，无须指明怎么做，存取路径的选择和 SQL 的操作过程由系统自动完成。

### 面向集合的操作方式

非关系数据库（NoSQL）采用的是面向记录的操作方式，操作对象是一条条的记录，该方式也成为 **一次一记录** （record-at-a-time）方式。

而关系数据库（SQL）采用的是面向集合（关系、元组的集合）的操作方式，称为 **一次一集合**（set-at-a-time）方式，操作对象和操作结果都是关系。

### 同一种语法结构提供多种使用方式

SQL 作为独立语言，可以独立地的用于『联机』交互的使用方式，直接在终端输入 SQL 命令进行操作。

SQL 作为嵌入语言，可以嵌入到 C/C++, JAVA, C# 等高级语言中，供程序设计时使用，一般各类管理系统就是这种方式。

## SQL 的三种模式

SQL 中也有三种模式，分别对应于关系数据库的三级模式。

* SQL 的外模式包括各类视图和部分基本表。
* SQL 的模式包括各类基本表。
* SQL 内模式包括各类存储文件，存储文件的 **逻辑结构** 组成了关系数据库的内模式。

## CREATE

```SQL
CREATE TABLE <表名> (
    col1 int primary key, -- 列级完整性约束
    col2 varchar(20),
);

CREATE VIEW <视图名>
as
select * from table_name;
```

## 数据查询

对于 `SELECT` 的一般格式为
```sql
SELECT [ALL | DISTINCT] <目标列表达式> [,<目标列表达式>]...
FROM <表名或视图名> [,<表名或视图名> ...] | (<SELECT 语句形成的派生表>) [AS] <别名>
[WHERE <条件表达式>]
[GROUP BY<列名1>] [HAVING <条件表达式>]
[ORDER BY<列名2>] [ASC | DESC]
```

### 单表查询

对于单表查询而言，不涉及到 JOIN 操作（当然视图消解可能得到 JOIN 操作）。

简单的例子，这里不在赘述。只记录几个值得记忆的例子。

1. 例子1
```sql
select Sname
from Student
where Sdept = 'CS';
```
DBMS 执行该 SQL 语句的过程，**可能** 为：对 `Student` 表进行『全表扫描』，取出一个元组，检查该元组在 `Sdept` 列的值是否等于 `'CS'`，如果相等，则取出 `Sname` 列的值形成一个新的元组输出；否则跳过该元组，取下一个元组。重复该过程，直到处理完 `Student` 表中的所有元组。

当然，『全表扫描』是低效的。一种优化方法是利用 **索引**，系统利用该索引找出 `Sdept = 'CS'` 的元组，从中取出 `Sname` 列值，形成新的结果。这就避免了全表扫描，加快查询速度。

注意到，如果表的规模较小时，索引查找并不一定能提高效率，系统仍然使用全表扫描。**这由查询优化器** 按照某些规则或估计执行代价来作出选择。
