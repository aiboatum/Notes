# SPOOLing 技术


> [SPOOLing 技术：CSDN](https://blog.csdn.net/dongyanxia1000/article/details/51867130)

SPOOL（外部设备联机并行操作，Simultaneous Peripheral Operations On-line）是一种数据缓冲，将低速的 I/O 设备的数据传送先放到缓冲区内。

SPOOLing 技术利用高速的共享设备（通常时磁盘）将 **低速** 的独享设备模拟为 **高速** 的共享设备。从逻辑上来看，计算机系统为每个用户都分配了一个独立的高速独享设备。

SPOOLing 技术通过 **多道程序技术** 将一台 I/O 设备虚拟成多台逻辑设备，因为从下面可以看出 SPOOLing 技术是通过两个进程模拟 『外围机』。

> SPOOLing 技术又称为假脱机技术，这是根据其工作特点命名的。又称为虚拟设备技术，这也是根绝其工作特点决定的。

## 脱机

在早期，无操作系统时期，都是作业的处理是通过人工操作的方式。如打孔的纸带作为数据的输入方式。该方式下，每个作业独占全机，CPU 等待人工操作，直到出现脱机输入/输出方式。

脱机处理，指的是程序和数据都是在外围控制器（外围机）的控制下完成，在 **脱离** 主机的情况下进行的，故而称之为 **脱机输入/输出**，反之，在主机的直接控制下进行的输入/输出方式称为 **联机输入/输出方式**。

该方式的特点：
- 减少 CPU 的空闲时间，提高了 I/O 速度
- 外围设备的数据需要先存到缓冲区中，CPU 不会立即处理，当缓冲区满后或等待时间到了，缓冲区数据才会送到 CPU 进行处理

## 假脱机

为了缓和 CPU 的高速和 I/O 设备的低速之间的矛盾而引入了『脱机输入』、『脱机输出』技术，该技术利用专门的 **外围控制器**，将低速的 I/O 设备上的数据传送到高速磁盘上。在内存中开辟一个缓冲区，该缓冲区和为了解决 **内存** 和 **磁盘** 之间的速度矛盾。而对于更加低速的 I/O 设备，如打印机，则需要通过 高速 I/O 设备（磁盘），来进行数据的中转。

事实上，当系统中引入了 **多道程序技术** 后，完全可以利用其中的一道程序，来 **模拟脱机输入时的外围控制机** 的功能，把低速I/O设备上的数据传送到高速磁盘上；再用另一道程序来模拟脱机输出时外围控制机的功能，把数据从磁盘上传送到低速输出设备上。这样，便可在主机的直接控制下，实现脱机输入、输出功能。此时的外围操作与CPU对数据的处理同时进行，我们把这种在 **联机** 情况下实现的同时外围操作称为 SPOOLing，或称为 **假脱机操作**。


### SPOOLing 系统的组成

SPOOLing 技术是对 **脱机输入、输出** 系统的模拟。因此，SPOOLing 系统必须建立在具有 **多道程序功能** 的操作系统上，而且还应该有 **高速随机外存** 的支持，这里的 **高速**、可以 **随机访问** 的外存是作为数据的中转站。

SPOOLing 系统一般由三部分组成：

1. **输入井和输出井**：在高速的随机外存，即中转站上开辟的空间。输入井模拟脱机输入时的磁盘设备，用于暂存 I/O 设备输入的数据；输出井是模拟脱机输出时的磁盘，用于暂存用户程序的输出数据。
2. **输入缓冲区和输出缓冲区**：一般提到缓冲区都是在内存中开辟的，解决内存和磁盘之间的速率矛盾。输入缓冲区用于暂存 I/O 设备送来的数据，然后传送到输入井中。输出缓冲区暂存从输出井送来的数据，以后再送到 I/O 设备。
3. **输入进程 SPi 和输出进程 SPo**。这里利用两个进程来模拟脱机 I/O 时的外围控制机。其中，进程 SPi 模拟脱机输入时的外围控制机，将用户要求的数据从 **输入机** 通过 **输入缓冲区** 再送到 **输入井**，当 CPU 需要输入数据时，直接从输入井读入内存；进程 SPo 模拟脱机输出时的外围控制机，把用户要求输出的数据先从内存送到输出井，待输出设备空闲时，再将输出井中的数据经过输出缓冲区送到输出设备上。


> 注意：I/O 设备之间的数据交换，一般通过内存。有了 DMA 控制方式和通道控制方式，I/O 设备可以和内存之间进行数据交换。

### SPOOLing 技术的特点

注意下面这句话，我们提取出 SPOOLing 技术的几个特点

> SPOOLing 技术利用高速的共享设备（通常时磁盘）将 **低速** 的独享设备模拟为 **高速** 的共享设备。从逻辑上来看，计算机系统为每个用户都分配了一个独立的高速独享设备。


1. 提高了 I/O 速度

对低速 I/O 设备的数据操作，转换为对于 输入井和输出井的数据操作，如同脱机一样，提高了 I/O 速度，缓和了 CPU 和 低速 I/O 设备之间的速度不匹配矛盾。

2. 将独占设备改造为共享设备
   
因为在 SPOOLing 系统中，实际上没有为任何进程分配设备，而只是在输入井或输出井中为进程分配一个存储区和建立一张 I/O 请求表。这样，便把独占设备改造为共享设备。 

3. 实现了虚拟设备功能

宏观上，虽然是多个进程在同时使用一台独占设备，而对于每一个进程而言，它们都会认为自己是独占了一个设备。当然，该设备只是逻辑上的设备。SPOOLing 系统实现了将独占设备变换为若干台对应的逻辑设备的功能。
