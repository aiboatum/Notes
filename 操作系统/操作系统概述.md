# 概述

> 本文主要为"现代操作系统"的读后笔记。

## 操作系统是什么？

一个中间层，用户（用户程序）和计算机硬件资源的中间层。

## 通过什么交互？

1. 命令接口：通过 shell 等命令解释器，面向用户/面向操作命令，用户可以利用这些命令操作和管理系统。
    - 如 login, logout, vi, cp, rm, ls, mv 等等
2. 系统调用：面向程序的接口
    - 如 read, write, open, close, wait, fork, socket 等等

> Shell是什么？ [Shell 是用来解决什么问题的？ - Bryan Yuan的回答 - 知乎](https://www.zhihu.com/question/35382632/answer/65331452)

# 操作系统基本特征

## 并发

其中，并行和并发区别如下

1. 并行是同时进行
2. 并发是宏观上的并行

## 共享

资源可以被多个并发进程共同使用

* 互斥共享
* 同时共享

## 虚拟

一个物理实体抽象为多个逻辑实体。

复用技术：时间复用、空间复用

## 异步

并发执行的过程中，进程的执行显然是断断续续的，它以不可预知的速度向前推进，这就是进程的异步性。

然而，OS 需要保证只要运行环境相同，多次执行必须获得相同的结果。

# 操作系统的功能构成

1. CPU 管理/CPU 调度/进程管理
2. 存储管理
    - 负责内存的分配和回收
    - 地址映射
    - 内存共享
3. 文件管理
    - 文件系统负责
    - 文件存储空间管理
    - 目录管理
    - 文件读写管理
4. 设备管理
    - I/O 
    - 虚拟设备

# 操作系统的分类

1. 早期的批处理系统
2. 多程序处理系统【并发】
3. 分时
4. 实时（real-time OS）
    - 为了能够及时相应优先级高的任务：某些重要的任务必须优先被执行
    - 按照排序运行、管理计算机资源
    - 最大特点：实时性
5. 网络操作系统，分布式操作系统

# 系统调用

内核提供了一系列的系统调用就是用户程序可见的操作系统接口，如

|系统调用|描述|
|:-|:-|
|fork()|创建进程|
|exit()	|结束当前进程
|wait()|	等待子进程结束
|kill(pid)|	结束 pid 所指进程
|getpid()|	获得当前进程 pid
|sleep(n)|	睡眠 n 秒
|exec(filename, *argv)|	加载并执行一个文件
|sbrk(n)	|为进程内存空间增加 n 字节
|open(filename, flags)|	打开文件，flags 指定读/写模式
|read(fd, buf, n)|	从文件中读 n 个字节到 buf
|write(fd, buf, n)|	从 buf 中写 n 个字节到文件
|close(fd)	|关闭打开的 fd
|dup(fd)	|复制 fd
|pipe( p)	|创建管道， 并把读和写的 fd 返回到p
|chdir(dirname)	|改变当前目录
|mkdir(dirname)	|创建新的目录
|mknod(name, major, minor)|	创建设备文件
|fstat(fd)|	返回文件信息
|link(f1, f2)|	给 f1 创建一个新名字(f2)
|unlink(filename)|	删除文件

## 内核态、用户态

内核态也称为管态和核心态。操作系统在**内核态**运行，可以访问整个硬件资源；用户程序只可在**用户态**下运行，只允许访问某些指令集。

用户程序通过**系统调用**进入内核态并调用操作系统。

![](image/1.png)

# 操作系统主要负责？

1. 进程管理
2. 文件管理
3. 内存管理
4. 设备管理
5. 系统调用

# 操作系统和 BIOS 

启动计算机（按下电脑开关键），先启动 BIOS 程序，BIOS 会做一些检查，然后加载操作系统到内存中，启动操作系统。

# 地址空间 

虚拟内存技术相关。

# 中断

## 外中断

外部事件引发，最常见的 IO 中断、时钟中断。

## 内中断（异常中断）

内部发生异常引起，如数组越界、算术溢出等等

## 陷入（也可称之为内中断）

系统调用引起的。

## 中断处理

1. 关中断：CPU 响应中断后，需要保存现场状态，保存过程中不可响应其他中断请求，否则会丢失现场。
2. 保存断点：保证中断服务程序可以正确的返回原来的程序。
3. 中断服务程序：取出中断服务程序的入口地址送到程序计数器 PC。
    1. 保存现场
    2. 开中断：此时允许响应更高级的中断请求
    3. 关中断：保证在恢复现场时不被中断
    4. 恢复现场
    5. 开中断、中断返回
